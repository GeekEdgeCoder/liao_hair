var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(t){i(t)}}function a(e){try{c(r["throw"](e))}catch(t){i(t)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Player=function(){function e(){}return e}();__reflect(Player.prototype,"Player");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?r(o):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.httpClient=new HttpClient,egret.lifecycle.addLifecycleListener(function(e){console.log(e)}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r;return __generator(this,function(o){switch(o.label){case 0:return[4,this.loadResource()];case 1:return o.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=o.sent(),[4,platform.login()];case 3:return t=o.sent(),[4,platform.getUserInfo()];case 4:return n=o.sent(),console.log(n),console.log(t.code),[4,toPromise(this.httpClient.post(webServerURL+"sign/in",t))];case 5:return r=o.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var r=new eui.Theme("resource/default.thm.json",e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;console.log(e,t),this.control=new Control,this.addChild(this.control)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t.prototype.startAnimation=function(e){var t=this,n=new egret.HtmlTextParser,r=e.map(function(e){return n.parse(e)}),o=this.textfield,i=-1,s=function(){i++,i>=r.length&&(i=0);var e=r[i];o.textFlow=e;var n=egret.Tween.get(o);n.to({alpha:1},200),n.wait(2e3),n.to({alpha:0},200),n.call(s,t)};s()},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t.prototype.onSocketOpen=function(){var e="Hello Egret WebSocket";console.log("连接成功，发送数据："+e),this.webSocket.writeUTF(e)},t.prototype.onReceiveMessage=function(e){var t=this.webSocket.readUTF();console.log("收到数据："+t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var test=function(){function e(){}return e}();__reflect(test.prototype,"test");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function o(e){t.call(r,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(r))}"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(r,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var STATE;!function(e){e[e.MAIN=0]="MAIN",e[e.MATCHIMG=1]="MATCHIMG",e[e.FIGHT_BEGIN=2]="FIGHT_BEGIN",e[e.FIGHT_OVER=3]="FIGHT_OVER"}(STATE||(STATE={}));var webServerURL="http://localhost:3300/",BackInfo=function(){function e(){}return e}();__reflect(BackInfo.prototype,"BackInfo");var BackResult=function(){function e(){}return e}();__reflect(BackResult.prototype,"BackResult");var FightInfo=function(){function e(){}return e}();__reflect(FightInfo.prototype,"FightInfo");var FightResult=function(){function e(){}return e}();__reflect(FightResult.prototype,"FightResult");var InstantInfo=function(){function e(){}return e}();__reflect(InstantInfo.prototype,"InstantInfo");var InstantResult=function(){function e(){}return e}();__reflect(InstantResult.prototype,"InstantResult");var Control=function(e){function t(){var t=e.call(this)||this;return t.state=STATE.MAIN,t.mainScenes=new MainScenes,t.matchingScenes=new MatchingScenes,t.fightBeginScenes=new FightBeginScenes,t.fightOverScenes=new FightOverScenes,t.addChild(t.mainScenes),t.mainScenes.beginButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.btnBeginClick,t),t.loadMain(),t}return __extends(t,e),t.prototype.loadMain=function(){this.addChild(this.mainScenes)},t.prototype.loadMatching=function(){this.addChild(this.matchingScenes)},t.prototype.loadFightBegin=function(){},t.prototype.loadFightOver=function(){},t.prototype.btnBeginClick=function(e){this.state=STATE.MATCHIMG,this.removeChild(this.mainScenes),this.toggleScenes(this.state)},t.prototype.toggleScenes=function(e){switch(e){case STATE.MAIN:this.loadMain();break;case STATE.MATCHIMG:this.loadMatching();break;case STATE.FIGHT_BEGIN:this.loadFightBegin();break;case STATE.FIGHT_OVER:this.loadFightOver()}},t}(egret.Sprite);__reflect(Control.prototype,"Control");var User=function(){function e(){}return e}();__reflect(User.prototype,"User");var Begin=function(){function e(){}return e.prototype.match=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,new Promise(function(){return new FightResult})];case 1:return e=t.sent(),this.renderFightInfo(e),[2]}})})},e.prototype.renderFightInfo=function(e){},e.prototype.renderError=function(){},e}();__reflect(Begin.prototype,"Begin");var Fight=function(){function e(e){}return e.prototype.render=function(){},e}();__reflect(Fight.prototype,"Fight");var FightBeginScenes=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(FightBeginScenes.prototype,"FightBeginScenes",["eui.UIComponent","egret.DisplayObject"]);var FightOverScenes=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(FightOverScenes.prototype,"FightOverScenes",["eui.UIComponent","egret.DisplayObject"]);var MainScenes=function(e){function t(){var t=e.call(this)||this;return t.skinName="MainSkin",t.setLayoutBoundsSize(640,338),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.createScenes,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.createScenes=function(){},t.prototype.onButtonClick=function(e){},t}(eui.Component);__reflect(MainScenes.prototype,"MainScenes",["eui.UIComponent","egret.DisplayObject"]);var MatchingScenes=function(e){function t(){var t=e.call(this)||this;return t.skinName="MatchingSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(MatchingScenes.prototype,"MatchingScenes",["eui.UIComponent","egret.DisplayObject"]);var MatchScene=function(){function e(){}return e.prototype.main=function(e){return void 0===e&&(e=-1),e===STATE.MAIN},e.prototype.matching=function(e){return void 0===e&&(e=-1),e===STATE.MATCHIMG},e.prototype.fightBegin=function(e){return void 0===e&&(e=-1),e===STATE.FIGHT_BEGIN},e.prototype.fightOver=function(e){return void 0===e&&(e=-1),e===STATE.FIGHT_OVER},e}();__reflect(MatchScene.prototype,"MatchScene");var PomeloForEgret;!function(e){var t=function(){function e(){this.JS_WS_CLIENT_TYPE="js-websocket",this.JS_WS_CLIENT_VERSION="0.0.5",this.RES_OK=200,this.RES_FAIL=500,this.RES_OLD_CLIENT=501,this.socket=null,this.callbacks={},this.handlers={},this.routeMap={},this.heartbeatInterval=0,this.heartbeatTimeout=0,this.nextHeartbeatTimeout=0,this.gapThreshold=100,this.heartbeatId=null,this.heartbeatTimeoutId=null,this.handshakeCallback=null,this.initCallback=null,this._callbacks={},this.reqId=0,console.group||(console.group=console.log,console.groupEnd=function(){console.log("----")},console.info=console.log,console.warn=console.log,console.error=console.log),this._message=new r,this._package=new n,this.socket=null,this.callbacks={},this.handlers={},this.routeMap={},this.heartbeatInterval=0,this.heartbeatTimeout=0,this.nextHeartbeatTimeout=0,this.gapThreshold=100,this.heartbeatId=null,this.heartbeatTimeoutId=null,this.handshakeCallback=null,this.handshakeBuffer={sys:{type:this.JS_WS_CLIENT_TYPE,version:this.JS_WS_CLIENT_VERSION},user:{}},this.initCallback=null,this.reqId=0,this.handlers[n.TYPE_HANDSHAKE]=this.handshake,this.handlers[n.TYPE_HEARTBEAT]=this.heartbeat,this.handlers[n.TYPE_DATA]=this.onData,this.handlers[n.TYPE_KICK]=this.onKick}return e.prototype.init=function(e,t){console.log("init",e),this.initCallback=t;var n=e.host,r=e.port;this.handshakeBuffer.user=e.user,this.handshakeCallback=e.handshakeCallback,this.initWebSocket(n,r,t)},e.prototype.initWebSocket=function(e,t,n){console.log("[Pomelo] connect to:",e,t),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.Event.CONNECT,this.onConnect,this),this.socket.addEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOError,this),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onMessage,this),this.socket.connect(e,t)},e.prototype.on=function(e,t){(this._callbacks[e]=this._callbacks[e]||[]).push(t)},e.prototype.request=function(t,n,r){if(2===arguments.length&&"function"==typeof n?(r=n,n={}):n=n||{},t=t||n.route){this.reqId++,this.reqId>127&&(this.reqId=1);var o=this.reqId;e.DEBUG&&(console.group("REQUEST:"),console.info("Route:",t),console.log("Id:",o),console.log("Param:",n),console.groupEnd()),this.sendMessage(o,t,n),this.callbacks[o]=r,this.routeMap[o]=t}},e.prototype.notify=function(e,t){this.sendMessage(0,e,t)},e.prototype.onMessage=function(e){var t=new egret.ByteArray;this.socket.readBytes(t),this.processPackage(this._package.decode(t))},e.prototype.sendMessage=function(e,t,r){var o;o=this._message.encode(e,t,r),o=this._package.encode(n.TYPE_DATA,o),this.send(o)},e.prototype.onConnect=function(e){console.log("[Pomelo] connect success",e),this.socket.writeBytes(this._package.encode(n.TYPE_HANDSHAKE,o.strencode(JSON.stringify(this.handshakeBuffer)))),this.socket.flush()},e.prototype.onClose=function(t){console.error("[Pomelo] connect close:",t),this.emit(e.EVENT_CLOSE,t)},e.prototype.onIOError=function(t){this.emit(e.EVENT_IO_ERROR,t),console.error("socket error: ",t)},e.prototype.onKick=function(t){this.emit(e.EVENT_KICK,t)},e.prototype.onData=function(e){var t=this._message.decode(e);t.id>0&&(t.route=this.routeMap[t.id],delete this.routeMap[t.id],!t.route)||this.processMessage(t)},e.prototype.processMessage=function(t){if(!t.id)return e.DEBUG&&(console.group("EVENT:"),console.info("Route:",t.route),console.info("Msg:",t.body),console.groupEnd()),void this.emit(t.route,t.body);e.DEBUG&&(console.group("RESPONSE:"),console.info("Id:",t.id),console.info("Msg:",t.body),console.groupEnd());var n=this.callbacks[t.id];if(delete this.callbacks[t.id],"function"==typeof n){if(t.body&&500==t.body.code){var r={code:500,desc:"服务器内部错误",key:"INTERNAL_ERROR"};t.body.error=r}n(t.body)}},e.prototype.heartbeat=function(e){if(this.heartbeatInterval){var t=this._package.encode(n.TYPE_HEARTBEAT);if(this.heartbeatTimeoutId&&(egret.clearTimeout(this.heartbeatTimeoutId),this.heartbeatTimeoutId=null),!this.heartbeatId){var r=this;r.heartbeatId=egret.setTimeout(function(){r.heartbeatId=null,r.send(t),r.nextHeartbeatTimeout=Date.now()+r.heartbeatTimeout,r.heartbeatTimeoutId=egret.setTimeout(r.heartbeatTimeoutCb.bind(r,e),r,r.heartbeatTimeout)},r,r.heartbeatInterval)}}},e.prototype.heartbeatTimeoutCb=function(t){var n=this.nextHeartbeatTimeout-Date.now();n>this.gapThreshold?this.heartbeatTimeoutId=egret.setTimeout(this.heartbeatTimeoutCb,this,n):(console.error("server heartbeat timeout",t),this.emit(e.EVENT_HEART_BEAT_TIMEOUT,t),this._disconnect())},e.prototype.off=function(e,t){this.removeAllListeners(e,t)},e.prototype.removeAllListeners=function(e,t){if(0==arguments.length)return void(this._callbacks={});var n=this._callbacks[e];if(n){if(e&&!t)return void delete this._callbacks[e];var r=this.index(n,t._off||t);~r&&n.splice(r,1)}},e.prototype.index=function(e,t){if([].indexOf)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},e.prototype.disconnect=function(){this._disconnect()},e.prototype._disconnect=function(){console.warn("[Pomelo] client disconnect ..."),this.socket&&this.socket.connected&&this.socket.close(),this.socket=null,this.heartbeatId&&(egret.clearTimeout(this.heartbeatId),this.heartbeatId=null),this.heartbeatTimeoutId&&(egret.clearTimeout(this.heartbeatTimeoutId),this.heartbeatTimeoutId=null)},e.prototype.processPackage=function(e){this.handlers[e.type].apply(this,[e.body])},e.prototype.handshake=function(t){var r=JSON.parse(o.strdecode(t));if(r.code===this.RES_OLD_CLIENT)return void this.emit(e.EVENT_IO_ERROR,"client version not fullfill");if(r.code!==this.RES_OK)return void this.emit(e.EVENT_IO_ERROR,"handshake fail");this.handshakeInit(r);var i=this._package.encode(n.TYPE_HANDSHAKE_ACK);this.send(i),this.initCallback&&(this.initCallback(r),this.initCallback=null)},e.prototype.handshakeInit=function(e){e.sys&&(s.init(e.sys.dict),i.init(e.sys.protos)),e.sys&&e.sys.heartbeat?(this.heartbeatInterval=1e3*e.sys.heartbeat,this.heartbeatTimeout=2*this.heartbeatInterval):(this.heartbeatInterval=0,this.heartbeatTimeout=0),"function"==typeof this.handshakeCallback&&this.handshakeCallback(e.user)},e.prototype.send=function(e){this.socket&&this.socket.connected&&(this.socket.writeBytes(e),this.socket.flush())},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=[].slice.call(arguments,1),o=this._callbacks[e];if(o){o=o.slice(0);for(var i=0,s=o.length;s>i;++i)o[i].apply(this,r)}return this},e.DEBUG=!0,e.EVENT_IO_ERROR="io-error",e.EVENT_CLOSE="close",e.EVENT_KICK="onKick",e.EVENT_HEART_BEAT_TIMEOUT="heartbeat timeout",e}();e.Pomelo=t,__reflect(t.prototype,"PomeloForEgret.Pomelo");var n=function(){function e(){}return e.prototype.encode=function(e,t){var n=t?t.length:0,r=new egret.ByteArray;return r.writeByte(255&e),r.writeByte(n>>16&255),r.writeByte(n>>8&255),r.writeByte(255&n),t&&r.writeBytes(t,0,t.length),r},e.prototype.decode=function(e){var t,n=e.readUnsignedByte(),r=(e.readUnsignedByte()<<16|e.readUnsignedByte()<<8|e.readUnsignedByte())>>>0;return e.bytesAvailable>=r?(t=new egret.ByteArray,r&&e.readBytes(t,0,r)):console.log("[Package] no enough length for current type:",n),{type:n,body:t,length:r}},e.TYPE_HANDSHAKE=1,e.TYPE_HANDSHAKE_ACK=2,e.TYPE_HEARTBEAT=3,e.TYPE_DATA=4,e.TYPE_KICK=5,e}();__reflect(n.prototype,"Package",["IPackage"]);var r=function(){function e(){}return e.prototype.encode=function(t,n,r){var a=new egret.ByteArray,c=t?e.TYPE_REQUEST:e.TYPE_NOTIFY,h=i.encode(n,r)||o.strencode(JSON.stringify(r)),u=s.getID(n)||n;if(a.writeByte(c<<1|("string"==typeof u?0:1)),t)do{var l=t%128,d=Math.floor(t/128);0!=d&&(l+=128),a.writeByte(l),t=d}while(0!=t);return u&&("string"==typeof u?(a.writeByte(255&u.length),a.writeUTFBytes(u)):(a.writeByte(u>>8&255),a.writeByte(255&u))),h&&a.writeBytes(h),a},e.prototype.decode=function(t){var n,r=t.readUnsignedByte(),a=r&e.MSG_COMPRESS_ROUTE_MASK,c=r>>1&e.MSG_TYPE_MASK,h=0;if(c===e.TYPE_REQUEST||c===e.TYPE_RESPONSE){var u=0;do{var l=t.readUnsignedByte();h+=(127&l)*Math.pow(2,7*u),u++}while(l>=128)}if(c===e.TYPE_REQUEST||c===e.TYPE_NOTIFY||c===e.TYPE_PUSH)if(a)n=t.readUnsignedShort();else{var d=t.readUnsignedByte();n=d?t.readUTFBytes(d):""}h||"string"==typeof n||(n=s.getName(n));var p=i.decode(n,t)||JSON.parse(o.strdecode(t));return{id:h,type:c,route:n,body:p}},e.MSG_FLAG_BYTES=1,e.MSG_ROUTE_CODE_BYTES=2,e.MSG_ID_MAX_BYTES=5,e.MSG_ROUTE_LEN_BYTES=1,e.MSG_ROUTE_CODE_MAX=65535,e.MSG_COMPRESS_ROUTE_MASK=1,e.MSG_TYPE_MASK=7,e.TYPE_REQUEST=0,e.TYPE_NOTIFY=1,e.TYPE_RESPONSE=2,e.TYPE_PUSH=3,e}();__reflect(r.prototype,"Message",["IMessage"]);var o=function(){function e(){}return e.strencode=function(e){var t=new egret.ByteArray;return t.length=e.length,t.writeUTFBytes(e),t},e.strdecode=function(e){return e.readUTFBytes(e.bytesAvailable)},e}();__reflect(o.prototype,"Protocol");var i=function(){function e(){}return e.init=function(e){this._clients=e&&e.client||{},this._servers=e&&e.server||{}},e.encode=function(e,t){var n=this._clients[e];return n?this.encodeProtos(n,t):null},e.decode=function(e,t){var n=this._servers[e];return n?this.decodeProtos(n,t):null},e.encodeProtos=function(e,t){var n=new egret.ByteArray;for(var r in t)if(e[r]){var o=e[r];switch(o.option){case"optional":case"required":n.writeBytes(this.encodeTag(o.type,o.tag)),this.encodeProp(t[r],o.type,e,n);break;case"repeated":t[r]&&t[r].length>0&&this.encodeArray(t[r],o,e,n)}}return n},e.decodeProtos=function(e,t){for(var n={};t.bytesAvailable;){var r=this.getHead(t),o=e.__tags[r.tag];switch(e[o].option){case"optional":case"required":n[o]=this.decodeProp(e[o].type,e,t);break;case"repeated":n[o]||(n[o]=[]),this.decodeArray(n[o],e[o].type,e,t)}}return n},e.encodeTag=function(e,t){var n=void 0!=this.TYPES[e]?this.TYPES[e]:2;return this.encodeUInt32(t<<3|n)},e.getHead=function(e){var t=this.decodeUInt32(e);return{type:7&t,tag:t>>3}},e.encodeProp=function(e,t,n,r){switch(t){case"uInt32":r.writeBytes(this.encodeUInt32(e));break;case"int32":case"sInt32":r.writeBytes(this.encodeSInt32(e));break;case"float":var o=new egret.ByteArray;o.endian=egret.Endian.LITTLE_ENDIAN,o.writeFloat(e),r.writeBytes(o);break;case"double":var i=new egret.ByteArray;i.endian=egret.Endian.LITTLE_ENDIAN,i.writeDouble(e),r.writeBytes(i);break;case"string":r.writeBytes(this.encodeUInt32(e.length)),r.writeUTFBytes(e);break;default:var s=n.__messages[t]||this._clients["message "+t];if(s){var a=this.encodeProtos(s,e);r.writeBytes(this.encodeUInt32(a.length)),r.writeBytes(a)}}},e.decodeProp=function(t,n,r){switch(t){case"uInt32":return this.decodeUInt32(r);case"int32":case"sInt32":return this.decodeSInt32(r);case"float":var o=new egret.ByteArray;r.readBytes(o,0,4),o.endian=egret.Endian.LITTLE_ENDIAN;r.readFloat();return o.readFloat();case"double":var i=new egret.ByteArray;return r.readBytes(i,0,8),i.endian=egret.Endian.LITTLE_ENDIAN,i.readDouble();case"string":var s=this.decodeUInt32(r);return r.readUTFBytes(s);default:var a=n&&(n.__messages[t]||this._servers["message "+t]);if(a){var c=this.decodeUInt32(r);if(c){var h=new egret.ByteArray;r.readBytes(h,0,c)}return c?e.decodeProtos(a,h):!1}}},e.isSimpleType=function(e){return"uInt32"===e||"sInt32"===e||"int32"===e||"uInt64"===e||"sInt64"===e||"float"===e||"double"===e},e.encodeArray=function(e,t,n,r){var o=this.isSimpleType;if(o(t.type)){r.writeBytes(this.encodeTag(t.type,t.tag)),r.writeBytes(this.encodeUInt32(e.length));for(var i=this.encodeProp,s=0;s<e.length;s++)i(e[s],t.type,n,r)}else for(var a=this.encodeTag,c=0;c<e.length;c++)r.writeBytes(a(t.type,t.tag)),this.encodeProp(e[c],t.type,n,r)},e.decodeArray=function(e,t,n,r){var o=this.isSimpleType,i=this.decodeProp;if(o(t))for(var s=this.decodeUInt32(r),a=0;s>a;a++)e.push(i(t,n,r));else e.push(i(t,n,r))},e.encodeUInt32=function(e){var t=new egret.ByteArray;do{var n=e%128,r=Math.floor(e/128);0!==r&&(n+=128),t.writeByte(n),e=r}while(0!==e);return t},e.decodeUInt32=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.readUnsignedByte();if(t+=(127&r)*Math.pow(2,7*n),128>r)return t}return t},e.encodeSInt32=function(e){return e=0>e?2*Math.abs(e)-1:2*e,this.encodeUInt32(e)},e.decodeSInt32=function(e){var t=this.decodeUInt32(e),n=t%2===1?-1:1;return t=(t%2+t)/2*n},e.TYPES={uInt32:0,sInt32:0,int32:0,"double":1,string:2,message:2,"float":5},e._clients={},e._servers={},e}();__reflect(i.prototype,"Protobuf");var s=function(){function e(){}return e.init=function(e){this._names=e||{};var t=this._names,n=this._ids;for(var r in t)n[t[r]]=r},e.getID=function(e){return this._names[e]},e.getName=function(e){return this._ids[e]},e._ids={},e._names={},e}();__reflect(s.prototype,"Routedic")}(PomeloForEgret||(PomeloForEgret={}));var _this=this,toPromise=function(e){return new Promise(function(t,n){e.addEventListener(egret.ProgressEvent.COMPLETE,function(e){var n=e.currentTarget,r=n.response;try{r=JSON.parse(n.response)}catch(o){}finally{t(r)}},_this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){n(e)},_this)})},HttpClient=function(){function e(){}return e.prototype.get=function(e,t){void 0===t&&(t={"Content-Type":"application/x-www-form-urlencoded"});var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.open(e,egret.HttpMethod.GET);for(var r=0,o=Object.keys(t);r<o.length;r++){var i=o[r];n.setRequestHeader(i,t[i])}return n.send(),n},e.prototype.post=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={"Content-Type":"application/x-www-form-urlencoded"});var r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open(e,egret.HttpMethod.POST);for(var o=0,i=Object.keys(n);o<i.length;o++){var s=i[o];r.setRequestHeader(s,n[s])}return r.send(t),r},e}();__reflect(HttpClient.prototype,"HttpClient");